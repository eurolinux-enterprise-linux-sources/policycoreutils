From 1343534cf84bc99993fa99d6356619d5daf45eb5 Mon Sep 17 00:00:00 2001
From: Petr Lautrbach <plautrba@redhat.com>
Date: Tue, 12 Jan 2016 15:48:54 +0100
Subject: [PATCH] secon, newrole: fix inconsistence between --help and man page

Resolves: rhbz#1278811, rhbz#1278913
---
 newrole/newrole.1 |  8 +++++++-
 secon/secon.1     |  9 +++++++++
 secon/secon.c     | 51 +++++++++++++++++++++++++--------------------------
 3 files changed, 41 insertions(+), 27 deletions(-)

diff --git a/newrole/newrole.1 b/newrole/newrole.1
index 376c458..1729c7f 100644
--- a/newrole/newrole.1
+++ b/newrole/newrole.1
@@ -8,6 +8,7 @@ newrole \- run a shell with a new SELinux role
 [\fB-t\fR|\fB--type\fR]
 \fITYPE\fR
 [\fB-l\fR|\fB--level\fR]
+[\fB-p\fR|\fB--preserve-environment\fR]
 \fILEVEL\fR [-- [\fIARGS\fR]...]
 .SH DESCRIPTION
 .PP
@@ -38,7 +39,12 @@ specified by
 If
 \fILEVEL\fR
 is a range, the new context will have the sensitivity level and clearance
-specified by that range.
+specified by that range.  If the
+.B -p
+or
+.B --preserve-environment
+option is specified, the shell with the new SELinux context will preserve environment variables,
+otherwise a new minimal enviroment is created.
 .PP
 Additional arguments
 .I ARGS
diff --git a/secon/secon.1 b/secon/secon.1
index fcffbd8..7221b80 100644
--- a/secon/secon.1
+++ b/secon/secon.1
@@ -66,6 +66,9 @@ gets the exec context from the specified process PID
 \fB\-\-pid\-fs\fR
 gets the fscreate context from the specified process PID
 .TP
+\fB\-\-pid\-key\fR
+gets the key context from the specified process PID
+.TP
 \fB\-\-current\fR, \fB\-\-self\fR
 gets the context from the current process
 .TP
@@ -75,6 +78,9 @@ gets the exec context from the current process
 \fB\-\-current\-fs\fR, \fB\-\-self\-fs\fR
 gets the fscreate context from the current process
 .TP
+\fB\-\-current\-key\fR, \fB\-\-self\-key\fR
+gets the key context from the current process
+.TP
 \fB\-\-parent\fR
 gets the context from the parent of the current process
 .TP
@@ -83,6 +89,9 @@ gets the exec context from the parent of the current process
 .TP
 \fB\-\-parent\-fs\fR
 gets the fscreate context from the parent of the current process
+.TP
+\fB\-\-parent\-key\fR
+gets the key context from the parent of the current process
 .PP
 Additional argument
 .I CONTEXT
diff --git a/secon/secon.c b/secon/secon.c
index 6ba47e9..593a8df 100644
--- a/secon/secon.c
+++ b/secon/secon.c
@@ -64,32 +64,31 @@ static void usage(const char *name, int exit_code)
 {
 	fprintf(exit_code ? stderr : stdout,
 		"  Usage: %s [-%s] [ context | - ]\n"
-		"          --help        -h     Show this message.\n"
-		"          --version     -V     Show the version.\n"
-		"          --prompt      -P     Output in a format good for a prompt.\n"
-		"          --user        -u     Show the user of the context.\n"
-		"          --role        -r     Show the role of the context.\n"
-		"          --type        -t     Show the type of the context.\n"
-		"          --sensitivity -s     Show the sensitivity level of the context.\n"
-		"          --clearance   -c     Show the clearance level of the context.\n"
-		"          --mls-range   -m     Show the sensitivity to clearance range of \n"
-		"                               the context.\n"
-		"          --raw         -R     Show the context in \"raw\" format.\n"
-		"          --current            Get the context for the current process.\n"
-		"          --self               Get the context for the current process.\n"
-		"          --self-exec          Get the exec context for the current process.\n"
-		"          --self-fs            Get the fs context for the current process.\n"
-		"          --self-key           Get the key context for the current process.\n"
-		"          --parent             Get the context for the parent process.\n"
-		"          --parent-exec        Get the exec context for the parent process.\n"
-		"          --parent-fs          Get the fs context for the parent process.\n"
-		"          --parent-key         Get the key context for the parent process.\n"
-		"          --pid       -p <arg> Use the context from the specified pid.\n"
-		"          --pid-exec     <arg> Use the exec context from the specified pid.\n"
-		"          --pid-fs       <arg> Use the fs context from the specified pid.\n"
-		"          --pid-key      <arg> Use the key context from the specified pid.\n"
-		"          --file      -f <arg> Use the context from the specified file.\n"
-		"          --link      -L <arg> Use the context from the specified link.\n",
+		"          --help          -h            Show this message.\n"
+		"          --version       -V            Show the version.\n"
+		"          --prompt        -P            Output in a format good for a prompt.\n"
+		"          --user          -u            Show the user of the context.\n"
+		"          --role          -r            Show the role of the context.\n"
+		"          --type          -t            Show the type of the context.\n"
+		"          --sensitivity   -s            Show the sensitivity level of the context.\n"
+		"          --clearance     -c            Show the clearance level of the context.\n"
+		"          --mls-range     -m            Show the sensitivity to clearance range of \n"
+		"                                        the context.\n"
+		"          --raw           -R            Show the context in \"raw\" format.\n"
+		"          --current,      --self        Get the context for the current process.\n"
+		"          --current-exec, --self-exec   Get the exec context for the current process.\n"
+		"          --current-fs,   --self-fs     Get the fs context for the current process.\n"
+		"          --current-key,  --self-key    Get the key context for the current process.\n"
+		"          --parent                      Get the context for the parent process.\n"
+		"          --parent-exec                 Get the exec context for the parent process.\n"
+		"          --parent-fs                   Get the fs context for the parent process.\n"
+		"          --parent-key                  Get the key context for the parent process.\n"
+		"          --pid           -p <arg>      Use the context from the specified pid.\n"
+		"          --pid-exec      <arg>         Use the exec context from the specified pid.\n"
+		"          --pid-fs        <arg>         Use the fs context from the specified pid.\n"
+		"          --pid-key       <arg>         Use the key context from the specified pid.\n"
+		"          --file          -f <arg>      Use the context from the specified file.\n"
+		"          --link          -L <arg>      Use the context from the specified link.\n",
 		name, SECON_OPTS_SM);
 
 	exit(exit_code);
-- 
1.8.3.1

